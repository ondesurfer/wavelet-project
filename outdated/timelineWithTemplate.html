<!-- timeline-example-file with a template for the timeline items. In the new version we work without tamplates.-->


<!DOCTYPE HTML>
<html>
<head>
  <title>Timeline | Templates</title>

  <!-- load handlebars for templating, and create a template -->
  <script src="http://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>
 <!--  example-code from  vis-documentation page
 	<script id="item-template" type="text/x-handlebars-template">
    <table class="score">
      <tr>
        <td colspan="3" class="description">{{description}}</td>
      </tr>
      <tr>
        <td>{{player1}}</td>
        <th>{{score1}} - {{score2}}</th>
        <td>{{player2}}</td>
      </tr>
      <tr>
        <td><img src="http://flagpedia.net/data/flags/mini/{{abbr1}}.png" width="31" height="20" alt="{{abbr1}}"></td>
        <th></th>
        <td><img src="http://flagpedia.net/data/flags/mini/{{abbr2}}.png" width="31" height="20" alt="{{abbr2}}"></td>
      </tr>
    </table>
  </script>
 -->
 
   <!-- <script id="item-template" type="text/x-handlebars-template">
    <div id="itemDiv" style=" overflow: hidden; background-color: red; max-width:100px">
    <table id="wavelet-item" style="overflow: hidden; max-width: 50px; background-color: green">
      <tr>
        {{name}}
      </tr>
      <tr>
        <td style="overflow: hidden">{{description}}</td>
      </tr>
      <tr>
        <td><img src="{{picture}}" width="80" height="50"></td>
      </tr>
    </table>
    </div>

  </script> -->

	<script id="item-template" type="text/x-handlebars-template">
    <div id="itemDiv" style=" overflow: hidden; background-color: red; max-width:120px">
      <h3>
        {{name}}
      </h3>
      <div id="descriptionDiv" style="font-size: 0.8em; word-wrap: break-word; display: block" > {{description}}</div>
     
      <p><img src="{{picture}}" width="80" height="50"></p>
        
    </table>
    </div>
  </script>

	<script src="../../js/ext_libs/sql.js"></script>
	<script src="../../js/libs/dbMethods.js"></script>
  <script src="../../js/ext_libs/timeline_dist/vis.min.js"></script>
  <link href="../../js/ext_libs/timeline_dist/vis-timeline-graph2d.min.css" rel="stylesheet" type="text/css" />

  <style type="text/css">
  	body, html {
      font-family: sans-serif;
      font-size: 10pt;
    }

    .vis.timeline .item {
      border-color: #acacac;
      background-color: #efefef;
      box-shadow: 5px 5px 10px rgba(128,128,128, 0.3);
    }

    table .description {
      font-style: italic;
    }

    #visualization {
      position: relative;
      overflow: hidden;
    }
	/*#wavelet-item{
		max-width: 50px
		color: red
	}*/
    .logo {
      position: absolute;
      right: 10px;
      top: 10px;
    }
    .logo img {
      width: 120px;
    }
  </style>

  
</head>
<body>
<h1>WK 2014</h1>
<p style="max-width: 600px;">
  This example demonstrates using templates to format item contents. In this case <a href="http://handlebarsjs.com">handlebars</a> is used as template engine, but you can just use your favorite template engine or manually craft HTML from the data of an item.
</p>

<div id="visualization">
  <!--<div class="logo"><img src="http://upload.wikimedia.org/wikipedia/en/e/e8/WC-2014-Brasil.svg"></div>-->
</div>

<script type="text/javascript">
  // create a handlebars template
  var source   = document.getElementById('item-template').innerHTML;
  var template = Handlebars.compile(document.getElementById('item-template').innerHTML);




	//loads database (in loadWaveletDBforTimeline we execute the buildTimeline() function.)
	loadWaveletDBforTimeline();
	

function buildTimeline(target){
	
	var types=db.exec("SELECT type,year,description,logo FROM TYPES")[0].values;
	
	console.log(types);
	
	var waveletItems = [];
	for(var j=0; j<types.length; j++){
		var obj = {
			name: types[j][0],
			start: types[j][1]+'-06-01', //adding '-01-01' because in database we only save the year
			description: types[j][2],
			picture: "../../pictures/"+ types[j][3],
			//content: types[j][0],
			type: 'box',
			title: "<h2>"+types[j][0]+"</h2>"+"<p>"+types[j][2]+"</p>" + "<p><img src='../../pictures/"+ types[j][3] + "' width='80' height='50'></p>"
		};
		waveletItems.push(obj);
	}
	
	console.log(waveletItems);
	
	//creating the DataSet(part of vis.js) for the timeline
	var items = new vis.DataSet(waveletItems);
	
   // Configuration for the Timeline
  	var options = {
	    // specify a template for the items
	    template: template,
	    
	    //max zoom intervall as milliseconds  
	    zoomMin: 200000000000,
	    zoomMax: 20000000000000,
	    max: '2100-06-01',
	    min: '1900-06-01',
	    tooltip: {
	      followMouse: true,
	      overflowMethod: 'cap'
	    }
	  };

  // Create a Timeline
  var timeline = new vis.Timeline(target, items, options);
}  
  
  
  
  /** 
 *  Load the database named './wavelet_database.sqlite' (with calling a function ___,
 *  such that no additional waiting-tricks, like a timer, are needed).
 *  (must exist in the same folder as the html-file) in a new thread.
 *  (last modification: 28.4.17 Simon)
 */
function loadWaveletDBforTimeline(){
		//builds an HttpRequest on 'theUrl' and runs the 'callback' function with the content of the HttpRequest response
		function httpGetAsync(theUrl, callback){
   			var xmlHttp = new XMLHttpRequest();
   			xmlHttp.responseType = 'arraybuffer';
   			 
    		xmlHttp.onreadystatechange = function() { 
    			//if the XMLHttpRequest was successful run the callback function with the response
        		if (xmlHttp.readyState == 4 && xmlHttp.status == 200){
            		callback(xmlHttp.response);
    			}
    			else{
    				console.log("database could not be loaded");
    			}
    		};
    		xmlHttp.open("GET", theUrl, true); // true bedeutet, dass onreadystate in neuem thread aufgerufen wird
    		xmlHttp.send(null);
		}
		 
		//constructs the callback function and runs the HttpRequest
		function start(){			
			
			var callback = function(str){
				var uInt8Array = new Uint8Array(str);
				// do not use a 'var' here! So the database is saved as an global document. attribute
  				db = new SQL.Database(uInt8Array);
  				

  		  // DOM element where the Timeline will be attached
  			var container = document.getElementById('visualization');
   			//When the database is loaded, call the function "buildTimeline()".
  			buildTimeline(container);
  			
			};
			httpGetAsync('../../wavelet_database.sqlite', callback);				
		}
		
		start();
	}
</script>
</body>
</html>
